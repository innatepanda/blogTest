<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../mvp.css">
    
    <title>Document</title>
</head>
<body>
    <div>
        email
        <input name="email" /><br >
        password
        <input name="password"/>
        <button  id="login" onclick="login()">login</button>
        
    </div>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-auth.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.0/dist/js.cookie.min.js"></script>
<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  window.addEventListener("DOMContentLoaded", () => {
  var firebaseConfig = {
    apiKey: "AIzaSyCRJxdzuodYh3i3eydNsAE8xFjxSHWdW0w",
    authDomain: "blogtest-14ada.firebaseapp.com",
    databaseURL: "https://blogtest-14ada-default-rtdb.firebaseio.com",
    projectId: "blogtest-14ada",
    storageBucket: "blogtest-14ada.appspot.com",
    messagingSenderId: "975556708270",
    appId: "1:975556708270:web:e5f00eebca246453e0aa3f",
    measurementId: "G-G73JDL14WB"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();

  
  function login(e)
  {
    console.log(document.getElementById("login"))

  }
console.log("in")
document.getElementById("login")
            .addEventListener("click", (e)=>{
              e.preventDefault()
                console.log("pop")
                const email = document.getElementByName("email");
              const password = e.target.password.value;
              console.log("el", document.getElementByName("email"))
              console.log(document.getElementById("login"))
            })
  //
  firebase.auth().setPersistence(firebase.auth.Auth.Persistence.None)
  document.getElementById("login")
            .addEventListener("click", (event) => {
              
                //event.preventDefault();
                console.log("clicked")
              const email = event.target.email.value;
              const password = event.target.password.value;
 

  firebase
    .auth()
    .signInWithEmailAndPassword(email, password)
    .then(({ user }) => {
      console.log(user)
      return user.getIdToken().then((idToken) => {
        return fetch("/sessionLogin", {
          method: "POST",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
            "CSRF-Token": Cookies.get("XSRF-TOKEN"),
          },
          body: JSON.stringify({ idToken }),
        });
      });
    })
    .then(() => {
      return firebase.auth().signOut();
    })
    .then(() => {
      window.location.assign("/dashboard");
    });
  return false;
            })
});
</script>
</body>
</html>